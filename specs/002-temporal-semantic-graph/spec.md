# 特性规范：基于 GitHub 事件的一小时时序语义图构建

**特性分支**：`002-temporal-semantic-graph`  
**创建日期**：2026-01-14  
**状态**：草案  
**输入**：用户描述："然后这个文件是提供的数据集@2015-01-01-15.json，这个数据集的时间范围只有一个小时，就是我现在的任务是需要构建时序语义图，图应同时表达：1. 事件之间的时间顺序关系，2. 开发者与事件之间的行为关系，3. 节点与边上的语义属性，构建后的时序语义图格式支持选择为json和graphml，需要加入的语义属性应该是要通过真实的数据集中得出的而不是自己设置默认值，分支已经创建好了，继续使用当前002分支，不用新创建分支，所有生成的.md后缀的描述文件内容全部使用中文，回答也使用中文，并且请确保你完全理解我的需求之后再开始执行操作"

## 澄清

- 数据来源为 `data/2015-01-01-15.json`，其内容为 GitHub Archive 风格的一小时事件流，每行一个 JSON 对象，包含至少 `id`, `type`, `actor`, `repo`, `payload`, `public`, `created_at` 等字段。
- 本特性仅聚焦于**单个一小时窗口文件**构建时序语义图，但在该小时内按**分钟粒度**切分为一系列小快照图（最多约 60 个），而非跨多小时或多天的长期演化图。
- 图需要同时表达三类信息：
  - 事件之间按照 `created_at` 排序的**时间顺序关系**；
  - **开发者（actor）与事件之间的行为关系**，体现谁在何时对哪个仓库产生了什么类型的事件；
  - **节点与边的语义属性**，这些属性全部来自真实数据字段或在此基础上的派生指标，而不是拍脑袋设定的默认常量。
- 图的导出需要至少支持 **JSON** 和 **GraphML** 两种格式，用户可以选择导出格式；导出文件应与快照式方法类似存放在 `output/temporal-semantic-graph/` 目录下。
- 语义属性可以包括对原始字段的简单派生（例如：提交信息长度、PushEvent 的 `size` 作为强度等），只要这些派生完全基于真实字段计算。
- 本特性在首版中对该一小时内**所有仓库的事件统一建图**，不限定特定目标仓库；如需按仓库过滤，将在后续特性中通过可配置方式扩展。

## 用户场景与测试 *(必需)*

### 用户故事 1 - 从一小时 GitHub 事件构建按分钟划分的基础时序语义图（优先级：P1）

作为开源项目研究者，我需要从 `2015-01-01-15.json` 这一小时的 GitHub 事件数据中，按**分钟粒度**构建一系列时序语义图快照（每分钟一张或若干张），以便更精细地按照时间顺序查看该时间窗口内开发者与仓库之间的活动情况，并能够追踪事件之间的先后关系。

**优先级原因**：这是整个时序语义图建模的最小可用功能（MVP）——只要能够从单小时事件数据构建出带时间顺序和基本行为关系的图，就可以开始进行初步的结构与行为分析。

**独立测试**：在数据文件存在的前提下，只运行“一小时时序语义图构建”流程，不依赖其他特性（如快照对比、长期演化分析），即可通过检查按分钟划分输出的多个图结构和日志来验证是否正确表达了事件在每一分钟内的时间顺序以及开发者与事件、仓库之间的基础关系。

**验收场景**：

1. **前提** `data/2015-01-01-15.json` 文件存在且可读，**当** 运行时序语义图构建流程时，**则** 系统能够读取文件中所有事件记录，并按照 `created_at` 字段进行时间排序，再根据分钟粒度（例如 `2015-01-01T15:23`）将事件划分到对应一分钟的图快照中。
2. **前提** 数据文件中存在多个不同 `actor.login` 与多个 `repo.name`，**当** 在每分钟构建对应的时序语义图快照时，**则** 每张快照图中应出现该分钟内活跃的“开发者节点”和“仓库节点”，以及连接“开发者节点 → 事件节点 → 仓库节点”的行为关系链路。
3. **前提** 数据文件中包含多种 `type`（如 `PushEvent`, `CreateEvent`, `WatchEvent` 等），**当** 构建各分钟图时，**则** 每张快照中的事件节点应保留事件类型信息，并且在相应分钟范围内不丢失或打乱不同类型事件的顺序。

---

### 用户故事 2 - 为节点与边填充来自真实数据计算得到的语义属性（优先级：P1）

作为研究者，我希望图中的每个节点和边都携带能够解释其在时序演化中“作用和地位”的语义属性，而不仅仅是原始字段的简单搬运或次数统计。这些语义属性可以是例如：开发者节点的影响力评分（如 `influence_score`）、事件节点的重要性评分（如 `importance_score`）、开发者→事件边的贡献强度（如 `contribution_strength`）等，它们都必须基于 `2015-01-01-15.json` 中的真实数据和图结构自动计算得到，并且可用于后续的计算与推理。

**优先级原因**：没有语义属性的图只剩下抽象结构，研究者难以据此进行行为理解和解释性分析。语义属性是“时序语义图”区别于普通结构图的关键。

**独立测试**：在已有图结构的前提下，可以单独测试“语义属性填充”步骤，对一小部分事件进行人工抽样，核对节点和边上记录的属性是否与原始 JSON 中的字段以及根据规格中给出的计算规则一致或是明显可追溯的派生；特别是对评分类语义属性，需要验证其数值范围合理（如 0～1）且不同节点/边之间的相对大小符合直观预期。

**验收场景**：

1. **前提** 数据文件中存在 `actor`, `repo`, `payload`, `created_at` 等字段，**当** 构建节点和边时，**则** 开发者节点至少包含 `actor.id` 和 `actor.login`，仓库节点至少包含 `repo.id` 和 `repo.name`，事件节点至少包含 `id`, `type`, `created_at`。
2. **前提** 数据文件中存在 `PushEvent`，且其 `payload.size` 与 `payload.commits` 列表非空，**当** 为相关边或事件节点填充语义属性时，**则** 这些结构上应体现出此次 Push 的提交数量（例如记录 `payload.size`）、以及至少一个提交的关键信息（如 `commits[0].message` 的摘要）。
3. **前提** 选取不少于 50 条随机事件进行人工核查，**当** 对照原始 JSON 与图中的节点/边属性时，**则** 至少 95% 的属性值应与原始数据一致或为可解释的派生值（例如字符串截断、长度、计数等）。

---

### 用户故事 3 - 导出时序语义图为 JSON 与 GraphML 供后续分析（优先级：P2）

作为分析者，我希望能够将构建好的时序语义图导出为 JSON 和 GraphML 两种常见格式，存放在约定目录下，以便在其他工具（如网络分析工具或自定义脚本）中加载、可视化和进行进一步的计算。

**优先级原因**：虽然导出不影响图本身的构建，但对于后续复用和分析至关重要，是一个与构建流程解耦、但紧密相关的 P2 功能。

**独立测试**：在已有内存图结构的前提下，只运行导出模块，将图分别导出为 JSON 与 GraphML，使用标准第三方工具或简单脚本验证文件格式合法、语义信息完整即可。

**验收场景**：

1. **前提** 时序语义图在内存中已构建完成，**当** 用户选择导出为 JSON 时，**则** 系统在 `output/temporal-semantic-graph/` 目录生成结构化 JSON 文件，包含所有节点与边及其语义属性，并且文件能被简单脚本解析。
2. **前提** 时序语义图在内存中已构建完成，**当** 用户选择导出为 GraphML 时，**则** 系统在 `output/temporal-semantic-graph/` 目录生成合法的 GraphML 文件，使用常见图分析工具（如 Gephi）可以成功导入并看到节点、边及其属性。
3. **前提** 导出过程出现异常（例如磁盘不可写），**当** 导出失败时，**则** 系统应给出明确的中文错误提示，并记录到日志，而不会导致已有图结构丢失或程序崩溃。

---

### 边界情况

- 当 `data/2015-01-01-15.json` 文件不存在、路径错误或无法打开时：系统应给出清晰的中文错误信息，并记录日志，终止本次图构建流程。
- 当文件存在但内容为空或不包含任何有效事件行时：系统应构建一张空图或只包含元信息的图，并明确记录“当前时间窗口无事件”。
- 当部分事件缺失关键字段（如缺少 `actor` 或 `repo`）时：系统应跳过或降级处理这些事件，记录到日志中，但不影响其他事件的处理。
- 当单个事件行 JSON 解析失败时：系统应跳过该行，记录具体行号和错误原因，而不是整体失败。
- 当一小时内事件数量异常巨大导致内存或性能风险时：系统应在日志中记录警告信息，并可选地提供简单统计（例如事件总数、节点总数），但在规格层面不强制具体性能上限。

## 需求 *(必需)*

### 功能需求

- **FR-201**：系统必须能够从 `data/2015-01-01-15.json` 中顺序读取所有事件记录，并正确解析每一行 JSON 对象。
- **FR-202**：系统必须使用事件的 `created_at` 字段建立时间顺序关系，保证在构建图结构时，事件的先后顺序可在图中被还原或推断（例如通过时间属性或显式时间有向边）。
- **FR-203**：系统必须在图中显式建模以下节点类型：**事件节点**（代表单条 GitHub 事件）、**开发者节点**（来自 `actor`）、**仓库节点**（来自 `repo`），并建立开发者-事件、事件-仓库的关系边。
- **FR-204**：系统可以根据 `payload` 中的信息选择性建模**提交节点**或其他更细粒度实体，但这些节点必须与 `payload.commits` 或相关字段一一对应，而不是虚构出来。
- **FR-205**：系统必须为节点和边填充来自真实数据的基础语义属性。例如：事件节点至少包含 `id`, `type`, `created_at`；开发者节点至少包含 `actor.id`, `actor.login`；仓库节点至少包含 `repo.id`, `repo.name`；边至少包含关系类型（如“开发者-触发事件”、“事件-作用于仓库”）以及可选的时间戳。
- **FR-206**：系统必须基于真实数据和图结构计算一层更高阶的语义评分属性，而不是简单次数统计或虚构常量。至少包括：开发者节点级别的影响力评分（如 `influence_score`）、事件节点级别的重要性评分（如 `importance_score`）、以及开发者→事件边级别的贡献强度（如 `contribution_strength`）。这些评分需要可解释地依赖于事件类型、提交数量、跨仓库/跨时间分布等因素，并将结果归一化到固定数值区间（例如 0～1），以便进行比较与推理。
- **FR-207**：系统必须提供导出功能，支持将同一一小时窗口内按分钟构建得到的一系列时序语义图快照导出为 JSON 格式，输出目录为 `output/temporal-semantic-graph/`，文件名应至少包含时间窗口与分钟信息（例如 `temporal-graph-2015-01-01-15-00.json`、`temporal-graph-2015-01-01-15-01.json` 等）。
- **FR-208**：系统必须提供导出功能，支持将同一一小时窗口内按分钟构建得到的一系列时序语义图快照导出为 GraphML 格式，输出目录与命名规则与 JSON 一致（例如 `temporal-graph-2015-01-01-15-00.graphml`）。
- **FR-209**：系统必须提供基础日志记录能力，至少记录：数据读取开始与结束时间、解析/构建过程中的错误与警告、生成文件的路径等信息，且日志内容使用中文描述。
- **FR-210**：所有对用户可见的提示信息（命令行输出、错误信息、文档）必须为中文，不出现未翻译的英文提示。
- **FR-211**：在构建图的过程中，如需进行事件筛选（例如只保留部分事件类型），筛选条件应在规格或配置中有明确定义，而不是硬编码在实现中；**首版默认保留所有类型事件，不做事件类型过滤**，后续如需要再通过配置支持白名单式过滤。

### 关键实体 *(涉及数据，需包含)*

- **时序语义图**：在给定一小时窗口内，由事件、开发者、仓库等节点以及它们之间的关系边构成的有向图。图中每个节点和边都带有语义属性，整体保留了时间顺序和行为语义信息。

- **事件节点（Event）**：对应数据文件中的单条 GitHub 事件记录，拥有唯一事件 ID（`id`）、事件类型（`type`）、发生时间（`created_at`），并可携带与 `payload` 相关的补充信息。

- **开发者节点（Actor/Developer）**：来自事件中的 `actor` 字段，代表触发事件的 GitHub 用户。至少包含开发者 ID（`actor.id`）和登录名（`actor.login`），可以附加头像 URL 等信息。

- **仓库节点（Repository）**：来自事件中的 `repo` 字段，代表事件作用的代码仓库。至少包含仓库 ID（`repo.id`）和名称（`repo.name`），可附加仓库 URL 等信息。

- **提交或载荷相关节点（Commit/Payload Entity）**：来自 `payload.commits` 或其他 `payload` 子字段，用于刻画具体提交或操作。**首版即引入“提交节点”，每个 commit 作为独立节点存在**，并通过“事件 → 提交”关系边表示 PushEvent 与提交之间的包含关系。

- **关系边（Edges）**：
  - 开发者 → 事件：表示某开发者在某时间触发了某个事件；
  - 事件 → 仓库：表示该事件所作用的目标仓库；
  - 事件 → 提交：对于 PushEvent，表示本次事件包含了哪些提交；
  - （可选）开发者 → 仓库：可通过聚合事件关系间接推导出长期的开发者-仓库关系，但在本特性中主要以事件为中介。

## 成功标准 *(必需)*

### 可衡量的结果

- **SC-201**：在普通开发环境中，针对单个 `2015-01-01-15.json` 文件，从读取到完成图构建与导出全部结果的总耗时应在可接受范围内（例如不超过 5 分钟），不会因为该一小时数据量而出现明显卡死或无法完成的情况。
- **SC-202**：随机抽样不少于 50 条事件记录，对照原始 JSON 与图中的节点/边及其属性，语义信息（如事件类型、开发者登录名、仓库名称、时间戳等）的准确率应不低于 95%。
- **SC-203**：导出的 JSON 文件可以被简单脚本重新加载并重建出节点和边数量一致的图结构，误差不超过 1%（例如仅允许因为错误行被跳过导致少量差异）。
- **SC-204**：导出的 GraphML 文件可以在至少一种常见图分析工具中成功导入，并能查看到节点与边的属性标签。
- **SC-205**：在构建和导出过程中出现的异常都应在日志中有清晰记录，且不会导致整个程序无提示崩溃；用户能够通过阅读日志了解问题大致原因。
- **SC-206**：所有最终对外展示的文档（本规格、后续计划、任务说明等）以及命令行输出均为中文，未发现未翻译的技术性英文提示。

## 假设

- 假设 `data/2015-01-01-15.json` 文件遵循 GitHub Archive 的标准格式，每行是一个完整的 JSON 事件对象。
- 假设每条事件记录都包含 `id`, `type`, `actor`, `repo`, `created_at` 等关键字段，只有少数异常记录会缺失这些字段。
- 假设当前特性仅处理单个一小时文件，不考虑跨文件的长时间串联分析；如需扩展到多小时或多天，将在后续特性中单独规划。
- 假设研究者主要关心开发者行为与仓库活动之间的关系，而不是 GitHub 上所有可能的元数据细节，因此只需在图中建模对当前分析最有价值的一部分实体和属性。
- 假设用户可以通过命令行或配置文件指定导出格式（JSON、GraphML 或两者），而不是每次都强制导出所有格式。

## 依赖关系

- 依赖 `data/2015-01-01-15.json` 数据文件已经按约定路径准备好。
- 依赖基础 JSON 解析能力，以逐行解析 GitHub 事件记录。
- 依赖图结构建模能力，用于在内存中表示带属性的有向图（具体技术选型在 plan 阶段确定，不在本规格中约束）。
- 依赖文件系统读写能力，以便从数据目录读取 JSON 文件，并向 `output/temporal-semantic-graph/` 写入导出结果。
- 依赖基础日志记录能力，以中文方式记录关键过程与错误信息。

## 超出范围

- 不包含跨多小时、多天或全局的长时间演化分析与对比，这些将由后续特性负责。
- 不包含复杂的图分析算法（如社区发现、中心性指标计算等），本特性仅负责构建和导出时序语义图本身。
- 不包含交互式可视化界面或 Web 仪表盘，仅考虑导出到标准格式供外部工具使用。
- 不考虑多种数据源混合（例如同时使用 GitHub Archive 和 GHTorrent）；本特性只面向单一 JSON 事件文件。
- 不对具体性能指标（如最大节点数、边数上限）做强约束，仅在成功标准中给出基本可用性的要求，具体调优留给后续实现与计划阶段。


