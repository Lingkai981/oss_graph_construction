# 特性规范：时间快照式时序图建模

**特性分支**：`001-snapshot-graph-construction`  
**创建日期**：2024-12-19  
**状态**：草案  
**输入**：用户描述："我要跑通ppt中的时间快照式时序图建模方法，最小化完成oss构图任务，当前我在GHTorrent下载了rxjs-ghtorrent.db，这是sqlite数据库，也就是说我已经获取了数据集，然后需要使用时间快照式的方法来进行图的构建，然后所有的文件内容要用中文来写"

## 澄清

### 会话 2024-12-19

- Q: 构建图快照时，应该按什么时间粒度来组织数据？ → A: 按天
- Q: 最小化实现中，图应该包含哪些类型的节点和边？ → A: 核心实体和关系（项目、贡献者、提交节点，以及贡献关系边）
- Q: 系统应该如何处理时间范围？ → A: 处理所有数据（系统自动识别数据库中的所有日期，处理全部可用数据）
- Q: 导出的图快照文件应该存储在哪里，如何命名？ → A: 输出目录，日期命名（存储在output/目录，文件名包含日期）
- Q: 当遇到数据异常（缺失时间戳、无效数据等）时，系统应该如何处理？ → A: 记录并跳过（记录错误到日志，跳过异常记录，继续处理其他数据）

## 用户场景与测试 *（必需）*

### 用户故事 1 - 从GHTorrent数据库提取时间快照数据（优先级：P1）

用户需要从rxjs-ghtorrent.db SQLite数据库中提取时间序列数据，以便在不同时间点创建图的快照。系统应该能够识别数据库中的时间戳字段，并按照时间顺序组织数据，为每个时间点准备图构建所需的数据。

**优先级原因**：这是整个图构建流程的基础。没有数据提取，后续的图构建无法进行。这是最小化实现（MVP）的核心组件。

**独立测试**：可以通过运行数据提取脚本，验证能够从数据库中读取时间序列数据，并输出为结构化格式（如JSON或CSV）。测试应该验证数据的时间顺序正确性，以及关键实体（如项目、贡献者、提交等）的识别准确性。

**验收场景**：

1. **前提** data/rxjs-ghtorrent.db数据库文件存在, **当** 运行数据提取脚本时, **则** 系统能够识别数据库中的表结构并提取包含时间戳的数据
2. **前提** 数据库包含多个日期的数据, **当** 提取数据时, **则** 系统自动识别所有可用日期，数据按照时间顺序组织，每个日期包含该时刻的实体和关系信息
3. **前提** 数据库中存在缺失或无效的时间戳, **当** 提取数据时, **则** 系统记录错误信息到日志，跳过无效记录，继续处理其他有效数据

---

### 用户故事 2 - 构建时间快照图（优先级：P2）

用户需要在特定时间点构建图的快照。系统应该能够根据提取的时间序列数据，在指定的时间点创建图结构，包括节点（实体）和边（关系）。每个快照代表该时间点的项目状态。

**优先级原因**：这是时间快照式方法的核心功能。虽然依赖于数据提取，但这是独立可测试的功能模块，可以接受预处理的数据作为输入。

**独立测试**：可以通过提供预定义的时间点数据，验证系统能够构建对应的图结构。测试应该验证节点和边的正确性，以及图的基本属性（如节点数、边数、连通性等）。

**验收场景**：

1. **前提** 某个时间点的数据已提取, **当** 构建该时间点的图快照时, **则** 系统创建包含正确节点和边的图结构
2. **前提** 多个连续日期的数据, **当** 构建每个日期的快照时, **则** 系统能够为所有可用日期生成一系列图快照，每个快照反映该日期的项目状态
3. **前提** 某个时间点没有数据, **当** 构建该时间点的快照时, **则** 系统能够创建空图或使用前一个快照的状态

---

### 用户故事 3 - 导出和可视化图快照（优先级：P3）

用户需要能够查看和导出构建的图快照。系统应该提供基本的图导出功能（如GraphML、JSON格式），并可能提供简单的可视化能力，帮助用户理解图的结构和演化。

**优先级原因**：虽然对于验证图构建的正确性很重要，但这是增强功能，可以在核心功能完成后实现。最小化实现可以只包含基本的导出功能。

**独立测试**：可以通过构建一个图快照，然后导出为指定格式，验证导出文件的正确性和完整性。测试应该验证导出的图可以被标准图工具读取。

**验收场景**：

1. **前提** 已构建的图快照, **当** 导出为GraphML格式时, **则** 系统在output/目录生成有效的GraphML文件（文件名包含日期），包含所有节点和边的信息
2. **前提** 已构建的图快照, **当** 导出为JSON格式时, **则** 系统在output/目录生成结构化的JSON文件（文件名包含日期），可以被其他工具解析
3. **前提** 多个日期的图快照, **当** 导出所有快照时, **则** 系统在output/目录为每个日期生成独立的文件（文件名包含对应日期）

---

### 边界情况

- 当数据库文件不存在或无法访问时：系统记录错误到日志并终止执行
- 当数据库中没有时间戳字段或时间戳格式不一致时：系统记录警告到日志，尝试识别常见的时间戳格式，无法识别时跳过该记录
- 当某个日期的数据量过大（如包含数万个节点）时：系统继续处理，但记录性能警告到日志
- 当日期之间的数据存在冲突或不一致时：系统使用该日期最新的数据，记录冲突信息到日志
- 当数据库表结构不符合预期时：系统记录错误信息到日志，尝试降级处理（如使用可用的表），完全无法处理时终止执行

## 需求 *（必需）*

### 功能需求

- **FR-001**: 系统必须能够连接到SQLite数据库（data/rxjs-ghtorrent.db）并读取表结构
- **FR-002**: 系统必须能够识别数据库中的时间戳字段，支持常见的日期时间格式
- **FR-003**: 系统必须能够自动识别数据库中的所有日期，按照时间顺序提取数据，按天粒度组织数据，为每个日期准备图构建所需的数据
- **FR-004**: 系统必须能够在指定日期构建图快照，包括创建核心节点类型（项目、贡献者、提交）和贡献关系边
- **FR-005**: 系统必须能够处理时间序列数据，支持在多个日期创建图快照（按天粒度）
- **FR-006**: 系统必须能够导出图快照为标准格式（至少支持GraphML或JSON格式之一），文件存储在output/目录，文件名包含日期（如snapshot_2024-01-01.graphml）
- **FR-007**: 系统必须能够处理数据异常情况（缺失时间戳、无效数据等），采用记录并跳过策略：将错误信息记录到日志，跳过异常记录，继续处理其他数据
- **FR-008**: 系统必须提供基本的日志功能，记录数据提取和图构建的过程
- **FR-009**: 所有用户界面、文档和输出信息必须使用中文

### 关键实体 *（如果功能涉及数据则包含）*

- **时间快照**：在特定时间点捕获的图状态，包含该时刻的所有节点和边。每个快照代表项目在该时间点的完整状态。

- **节点**：图中的实体，最小化实现包含三种类型：（1）项目节点 - 代表开源项目；（2）贡献者节点 - 代表项目贡献者；（3）提交节点 - 代表代码提交。每个节点具有唯一标识符和属性（如名称、类型、创建时间等）。

- **边**：节点之间的关系，最小化实现包含贡献关系边，连接贡献者节点和提交节点，表示某个贡献者在某个时间点进行了代码提交。每条边包含类型、创建时间等属性。

- **时间序列数据**：包含时间戳的数据记录，用于确定实体和关系在时间轴上的出现和变化。

## 成功标准 *（必需）*

### 可衡量的结果

- **SC-001**: 系统能够在5分钟内从data/rxjs-ghtorrent.db数据库中提取至少1000天的数据
- **SC-002**: 系统能够成功构建至少10个不同日期的图快照（按天粒度），每个快照包含至少100个节点和200条边
- **SC-003**: 构建的图快照能够正确反映该时间点的项目状态，节点和边的准确性达到95%以上（通过人工抽样验证）
- **SC-004**: 导出的图文件能够被标准图分析工具（如Gephi、Cytoscape）成功导入和可视化
- **SC-005**: 系统能够处理数据库中的异常情况，至少90%的异常数据能够被正确识别和处理，不会导致系统崩溃
- **SC-006**: 所有用户可见的输出（日志、错误信息、文档）都使用中文，中文内容的准确性达到100%

## 假设

- GHTorrent数据库包含标准的时间戳字段，用于标识事件发生的时间
- 数据库中的表结构符合GHTorrent的标准格式，包含项目、用户、提交、问题等常见实体
- 时间快照的粒度固定为按天，每个快照代表一天结束时的项目状态
- 图的结构（节点类型、边类型）在最小化实现中限定为核心类型：节点类型包括项目、贡献者、提交；边类型包括贡献关系（贡献者-提交）
- 最小化实现优先支持核心功能，高级功能（如复杂可视化、图分析算法）可以在后续迭代中添加

## 依赖关系

- 需要访问data/rxjs-ghtorrent.db SQLite数据库文件（已准备就绪）
- 需要SQLite数据库驱动或库来读取数据库
- 需要图数据结构库来构建和操作图（具体技术选择在plan阶段确定）
- 可能需要时间处理库来处理和解析时间戳数据

## 超出范围

- 复杂的图分析算法（如社区检测、中心性分析等）- 这些可以在后续迭代中添加
- 实时数据同步和更新 - 当前版本只处理静态数据库快照
- 高级可视化功能（如交互式图形界面）- 最小化实现只包含基本导出功能
- 多数据库支持 - 当前版本只支持SQLite格式的GHTorrent数据库
- 图数据的持久化存储 - 当前版本只关注图的构建和导出，不涉及长期存储方案
